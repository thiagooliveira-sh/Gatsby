[build]
  publish = "public"
  command = "npm install --legacy-peer-deps && npm run build"

[build.environment]
  NODE_VERSION = "22"
  NPM_FLAGS = "--legacy-peer-deps"
  # Optimize image processing - single CPU reduces context switching
  GATSBY_CONCURRENT_DOWNLOAD = "10"
  GATSBY_CPU_COUNT = "1"
  # Reduce memory usage
  NODE_OPTIONS = "--max-old-space-size=3072"

[[plugins]]
package = "netlify-plugin-gatsby-cache"